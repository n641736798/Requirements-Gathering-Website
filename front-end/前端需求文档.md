# 前端需求文档 — 设备数据接入与查询平台

> 与 Linux C++ 高并发设备数据后端服务配套的前端需求说明。  
> 后端仓库：项目根目录，默认 `http://localhost:8080`。

---

## 一、项目背景

公司存在大量设备（如 IoT / 医疗 / 工业设备），设备持续上报运行数据。本平台用于：

- 统一接入设备数据（HTTP 上报）
- 准实时 / 历史查询设备数据
- 为后续告警、分析打基础

本项目为 **教学 / 练手 / 技术验证** 版本，**重点在后端能力与系统设计**。前端职责为：可访问页面、清晰调用接口、正确展示数据，**不追求复杂交互与精美 UI**。

---

## 二、整体架构

```
[ 浏览器 Web 前端 ]
        |
      HTTP
        |
[ Linux C++ 后端 ]  ← 本仓库
        |
  内存存储（MemoryStore）+ 设备管理（DeviceManager）
```

**技术选型（前端）**

- HTML + CSS + JavaScript
- 可选：原生 JS，或 Vue / React（不要求复杂）
- 展示：表格、折线图（Chart.js / ECharts 等）

**后端技术栈**：C++17、epoll、自实现 HTTP/JSON 解析，内存存储，详见根目录 `README.md` 与 `项目结构分析.md`。

---

## 三、用户角色

**管理员（唯一角色，简化）**

- 通过浏览器访问系统
- 查看设备数据、进行查询
- **不做登录 / 鉴权**

---

## 四、功能需求（前端视角）

### 4.1 设备列表页面（依赖后端扩展）

**说明**：展示已接入设备列表。**当前后端未提供设备列表接口**，该页面前端实现需以后端新增接口为前提。

**页面元素**

- 设备列表表格：
  - 设备 ID
  - 最近上报时间（若后端提供）
  - 最近一次关键指标（如 `heart_rate`，若后端提供）
- 操作列：「查看数据」跳转至 4.2 查询页
- 刷新按钮：重新请求列表

**表格示意（逻辑）**

```
| Device ID   | Last Time | HR  | Action   |
|-------------|-----------|-----|----------|
| ECG_1001    | 12:01:01  | 78  | 查看数据 |
| ECG_1002    | 12:01:05  | 81  | 查看数据 |
```

**对应接口（待后端实现）**

- `GET /api/v1/devices`
- 建议返回格式（供后端实现参考）：

```json
{
  "code": 0,
  "message": "ok",
  "data": {
    "devices": [
      {
        "device_id": "ECG_1001",
        "last_timestamp": 1700000010,
        "last_heart_rate": 78
      }
    ]
  }
}
```

**前端实现建议**：后端未实现前，可提供「输入设备 ID」表单，直接跳转 4.2 查询页，作为替代入口。

---

### 4.2 设备数据查询页面（核心，已支持）

**说明**：查看**某一设备**最近的历史数据。**当前后端已完整支持**。

**页面元素**

- 当前设备 ID 展示
- 查询参数：
  - 最近 N 条（默认 100，可选 10 / 50 / 100 / 200 / 500 / 1000）
- 「查询」按钮
- 数据表格：时间、`heart_rate`、`spo2` 等（按实际 `metrics` 字段展示）
- 折线图：时间 vs 指标（如心率、血氧）

**页面示意**

```
设备：ECG_1001
[ 最近 100 条 ▼ ] [ 查询 ]

| Time     | Heart Rate | SpO2 |
|----------|------------|------|
| 12:00:01 | 78         | 98   |
| 12:00:02 | 79         | 97   |
```

**对应接口（已实现）**

- **请求**：`GET /api/v1/device/query?device_id={id}&limit={n}`
- **参数**：
  - `device_id`（必填）：设备 ID
  - `limit`（可选）：条数上限，默认 100，最大 1000

- **响应**（200）：**注意** 查询接口响应**不**使用通用 `code/message/data` 包装，直接为：

```json
{
  "device_id": "ECG_1001",
  "data": [
    {
      "timestamp": 1700000001,
      "heart_rate": 78,
      "spo2": 98
    }
  ]
}
```

- `data` 中每项包含 `timestamp` 及 `metrics` 下各指标（如 `heart_rate`、`spo2`），前端需按实际字段渲染表格与图表。

---

### 4.3 设备数据上报（设备侧）与模拟上报（可选）

**说明**：实际上报由设备通过 HTTP POST 完成，**前端不负责设备侧上报**。为演示系统完整性，前端可提供：

- **模拟上报** 入口（如按钮）
- 可固定或随机生成 `device_id`、`timestamp`、`metrics`，调用上报接口

**对应接口（已实现）**

- **请求**：`POST /api/v1/device/report`
- **请求头**：`Content-Type: application/json`
- **请求体**：

```json
{
  "device_id": "ECG_10086",
  "timestamp": 1700000000,
  "metrics": {
    "heart_rate": 78,
    "spo2": 98
  }
}
```

- **响应**（200 成功）：

```json
{
  "code": 0,
  "message": "ok"
}
```

---

## 五、接口约定（与当前后端一致）

### 5.1 通用错误格式

错误响应使用 JSON，且 `Content-Type` 为 `application/json`，格式：

```json
{
  "code": 400,
  "message": "Invalid request body"
}
```

**当前后端已使用的 code / message**：

| HTTP 状态码 | code | message | 场景 |
|-------------|------|---------|------|
| 400 | 400 | Invalid request | HTTP 解析失败 |
| 400 | 400 | Invalid request body | 上报 JSON 非法或缺少必填字段 |
| 400 | 400 | Missing device_id | 查询缺少 `device_id` 参数 |
| 404 | 404 | Not found | 路径非 `/api/v1/device/report`、`/api/v1/device/query` |

### 5.2 成功响应格式

- **上报**：`{ "code": 0, "message": "ok" }`，无 `data` 字段。
- **查询**：直接 `{ "device_id": "...", "data": [ ... ] }`，无 `code` / `message` 包装。

前端需按**实际接口**解析，避免假定查询接口也带 `code` / `message`。

### 5.3 跨域与 BaseURL

- 后端默认监听 `0.0.0.0:8080`，前端请求 BaseURL 一般为 `http://localhost:8080`。
- 若前后端分离部署，需后端支持 CORS，否则前端需通过同域代理访问。

---

## 六、非功能需求（与后端对齐）

### 6.1 前端侧

- **接口失败有提示**：请求 4xx/5xx 或网络异常时，前端需给出明确提示（如 Toast / 文案），不静默失败。
- **不阻塞后端迭代**：前端通过 REST API 与后端解耦，后端接口变更时优先更新本文档与前端调用。

### 6.2 后端侧（供参考，非前端实现）

- 性能：支持高并发连接、高 QPS；内存存储，平均响应时间较低。
- 稳定性：异常不导致进程崩溃；支持优雅退出。
- 可扩展：REST 风格接口，便于后续接告警、用户系统、多指标扩展。

---

## 七、前端开发范围控制（刻意收敛）

**必须**

- 页面可访问（设备数据查询页必备；设备列表页可待后端支持后再做）
- 数据能展示（表格、折线图）
- 接口调用清晰（上报、查询的 URL、方法、参数、响应格式与错误处理明确）

**不需要**

- 登录、鉴权
- 复杂美观 UI、动效
- 移动端适配

**原则**：一切为 **后端服务与接口联调** 让路，前端保持简单、可维护。

---

## 八、接口速查（与当前后端完全匹配）

| 功能 | 方法 | 路径 | 说明 |
|------|------|------|------|
| 设备数据上报 | POST | `/api/v1/device/report` | Body: JSON，见 4.3 |
| 设备数据查询 | GET | `/api/v1/device/query?device_id=xxx&limit=100` | 见 4.2 |
| 设备列表 | GET | `/api/v1/devices` | **当前未实现**，为 4.1 扩展预留 |

---

## 九、版本与维护

- 本文档与 **当前 C++ 后端实现** 保持一致。
- 后端新增接口（如 `GET /api/v1/devices`）或修改请求/响应格式时，应同步更新本文档及前端调用。

---

*文档版本：v1.0 | 对应后端：高并发设备数据接入与查询服务*
